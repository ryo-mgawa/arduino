# 早押しボタンシステム (Hayaoshi Button System)

## 概要

このプロジェクトは、Arduinoを利用したシンプルな「早押し」またはクイズ形式のボタンシステムです。複数のプレイヤーの中で最初にボタンを押した人を検出し、対応するLEDを点灯させることで勝者を示します。

## 特徴

*   最大3人のプレイヤーをサポート
*   最初に押されたボタンに対応するLEDによる視覚的なフィードバック
*   割り込み駆動によるボタン入力検出（ノンブロッキング）
*   起動時にLEDのテストシーケンスを実行

## 必要なハードウェア

*   Arduinoボード (例: Arduino Uno)
*   プレイヤーボタン (モーメンタリスイッチ) x3
*   プレイヤーLED x3
*   「正解/リセット」ボタン (マルボタン) x1 (現在はコメントアウトされていますが、将来的に使用可能)
*   「不正解/リセット」ボタン (バツボタン) x1 (現在はコメントアウトされていますが、将来的に使用可能)
*   LED用抵抗 (例: 220Ω または 330Ω)
*   ボタン用プルダウン抵抗 (例: 10kΩ) - `INPUT_PULLUP` は使用していません
*   ジャンパーワイヤー
*   ブレッドボード (プロトタイピング用、任意)

## 必要なソフトウェア

*   Arduino IDE
*   `Hayaoshi.ino` スケッチファイル

## ピン設定

| 機能             | Arduinoピン | 備考                     |
| ---------------- | ----------- | ------------------------ |
| プレイヤーボタン0 | デジタルピン 2 |                          |
| プレイヤーボタン1 | デジタルピン 3 |                          |
| プレイヤーボタン2 | デジタルピン 4 |                          |
| プレイヤーLED 0   | デジタルピン 10 |                          |
| プレイヤーLED 1   | デジタルピン 11 |                          |
| プレイヤーLED 2   | デジタルピン 12 |                          |
| マルボタン       | デジタルピン 6 | リセット用 (現在コメントアウト) |
| バツボタン       | デジタルピン 7 | リセット用 (現在コメントアウト) |
| 出力ピン         | デジタルピン 9 | 汎用出力 (初期状態 HIGH)   |

## 動作の仕組み

1.  **初期設定 (`setup()`):**
    *   各ピンのモードを設定します（プレイヤーボタンは `INPUT`、LEDは `OUTPUT`）。
    *   `outputPin` は `OUTPUT` に設定され、`HIGH` になります。
    *   `LedInit()`: 全てのプレイヤーLEDが1.5秒間点灯し、その後すべて消灯します（起動時のテストシーケンス）。
    *   プレイヤーボタン（D2, D3, D4）のピン変化割り込みを有効にし、ノンブロッキングでボタンの押下を検出します。

2.  **ボタン押下検出 (ISR - `PCINT2_vect`):**
    *   プレイヤーボタンの状態変化（押下されて `LOW` に遷移）によってトリガーされます。
    *   どのボタンが押されたかを識別します。
    *   まだ他のボタンが登録されていない場合 (`buttonFlag == BUTTON_OFF`)、押されたボタンのインデックス (`pressedButtonIndex`) を記録します。

3.  **メインループ (`loop()`):**
    *   ボタンの押下が登録され、まだ勝者が決まっていない場合、`LedOn(pressedButtonIndex)` が呼び出されます。
    *   `LedOn(ledNum)`: 対応するLEDを点灯 (`HIGH`) し、`buttonFlag = BUTTON_ON` に設定して他のボタンからの入力をロックします。

4.  **リセット機構 (コメントアウトされている機能):**
    *   `loop()` 内には、`maruButton` または `batsuButton` を使用したリセット処理のコードがコメントアウトされています。
    *   この機能が有効化されると、いずれかのボタンを押すことで `ButtonInit()`（`buttonFlag` と `pressedButtonIndex` をリセット）および `LedInit()`（LEDの起動シーケンスを再実行）が呼び出されます。

## 使用方法

1.  上記の「必要なハードウェア」セクションに従って、コンポーネントをArduinoに接続します。
2.  Arduino IDEを開き、`Hayaoshi.ino` スケッチをArduinoボードにアップロードします。
3.  電源を入れると、LEDの初期化シーケンスが実行されます。
4.  いずれかのプレイヤーがボタンを押すと、そのプレイヤーに対応するLEDが点灯します。

## 将来的な拡張

*   `maruButton`（正解ボタン）および `batsuButton`（不正解ボタン）を使用したリセット機能の実装。これにより、ゲームをリセットして次のラウンドを開始できるようになります。
*   ブザーや追加のステータスLEDを `outputPin` に接続して、音や追加の視覚フィードバックを追加する。
